name: Refresh MTG Card Data

on:
  # ── runs every day at 6:00 AM UTC ──
  schedule:
    - cron: '0 6 * * *'

  # ── also lets you click "Run workflow" manually in the Actions tab ──
  # This is how you trigger it instantly after adding a new person to config.json.
  workflow_dispatch:

jobs:
  refresh:
    runs-on: ubuntu-latest

    steps:
      # ── checkout the repo ──
      - uses: actions/checkout@v4

      # ── run the fetcher ──
      # All PHONE_* secrets are passed as env vars automatically.
      - name: Fetch card data from Moxfield
        run: node fetch.js
        env:
          PHONE_VALLHAY:  ${{ secrets.PHONE_VALLHAY }}
          PHONE_NACHO:  ${{ secrets.PHONE_NACHO }}
          PHONE_GUILLO: ${{secrets.PHONE_GUILLO}}
          PHONE_ANGIE: ${{secrets.PHONE_ANGIE}}
          PHONE_CARMELO: ${{secrets.PHONE_CARMELO}}
          PHONE_LICHA: ${{secrets.PHONE_LICHA}}
          PHONE_LUCHO: ${{secrets.PHONE_LUCHO}}
          PHONE_RODRIGO_DEGANUTTI: ${{ secrets.PHONE_RODRIGO_DEGANUTTI }}
          # ── add more phones here as you add people ──
          # PHONE_FRIEND2:  ${{ secrets.PHONE_FRIEND2 }}

      # ── commit & push the new data/cards.json back to the repo ──
      # If nothing changed (no new cards), this step does nothing.
      - name: Commit updated data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: refresh card data"
          file_pattern: 'data/cards.json'
